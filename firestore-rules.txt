// Firestore Security Rules for SGSA Scouts Admin System
// Copy and paste these rules into your Firebase Console > Firestore Database > Rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check if user is authenticated admin
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // Helper function to check if user is authorized admin
    // You can customize this list with your admin email addresses
    function isAuthorizedAdmin() {
      return isAuthenticated() && 
             request.auth.token.email in [
               'admin@sgsascouts.com',           // Replace with your admin email
               'leader@sgsascouts.com',          // Add more admin emails as needed
               'coordinator@sgsascouts.com',
               'mbaskhairoun@gmail.com',
               'tamerthomas5@gmail.com'      // You can add multiple admins
             ];
    }
    
    // Scout collection rules
    match /scouts/{scoutId} {
      // Allow read/write only for authenticated admins
      allow read, write: if isAuthorizedAdmin();
      
      // Alternative: Allow any authenticated user (less secure)
      // allow read, write: if isAuthenticated();
    }
    
    // Attendance collection rules
    match /attendance/{attendanceId} {
      // Allow read/write only for authenticated admins
      allow read, write: if isAuthorizedAdmin();
      
      // Ensure attendance records include required fields when creating
      allow create: if isAuthorizedAdmin() && 
                   resource.data.keys().hasAll(['scoutId', 'date', 'status', 'timestamp']);
                   
      // Allow updates but preserve original scoutId and date
      allow update: if isAuthorizedAdmin() && 
                   resource.data.scoutId == request.resource.data.scoutId &&
                   resource.data.date == request.resource.data.date;
    }
    
    // Settings collection rules (optional - for storing admin preferences)
    match /settings/{settingId} {
      allow read, write: if isAuthorizedAdmin();
    }
    
    // Deny all other access
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

// IMPORTANT SETUP INSTRUCTIONS:
// 
// 1. Go to Firebase Console (https://console.firebase.google.com/)
// 2. Select your project (sgsa-kids)
// 3. Navigate to "Firestore Database" in the left sidebar
// 4. Click on the "Rules" tab
// 5. Replace the existing rules with the rules above
// 6. Update the admin email addresses in the isAuthorizedAdmin() function
// 7. Click "Publish" to save the rules
//
// SECURITY LEVELS (choose one approach):
//
// OPTION 1 - Email-based Admin Access (RECOMMENDED):
// - Replace the email addresses in isAuthorizedAdmin() with your actual admin emails
// - Only users with those specific email addresses can access the data
// - Most secure option
//
// OPTION 2 - Any Authenticated User (LESS SECURE):
// - Replace isAuthorizedAdmin() with isAuthenticated() in the allow rules
// - Any user who can log in can access the data
// - Easier to manage but less secure
//
// OPTION 3 - Development/Testing (TEMPORARY ONLY):
// - Use: allow read, write: if true;
// - Anyone can access the data (NO SECURITY)
// - Only use this for initial testing, then switch to Option 1 or 2